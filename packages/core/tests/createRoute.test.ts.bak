/**
 * @vitest-environment jsdom
 */

 import assert, { deepEqual, throws } from 'assert';
 import { describe, expect, it, beforeAll, beforeEach } from 'vitest'
 import route from '../src/createRoute';
 
 const defaultWindow = {
     location: {
         host: 'navigare.test:443',
     },
 };
 
 const defaultZiggy = {
     url: 'https://navigare.test:443/navigare',
     port: null,
     defaults: { locale: 'en' },
     routes: {
         home: {
             uri: '/',
             methods: ['GET', 'HEAD'],
         },
         'posts.index': {
             uri: 'posts',
             methods: ['GET', 'HEAD'],
         },
         'posts.show': {
             uri: 'posts/{post}',
             methods: ['GET', 'HEAD'],
             bindings: {
                 post: 'id',
             },
         },
         'posts.update': {
             uri: 'posts/{post}',
             methods: ['PUT'],
             bindings: {
                 post: 'id',
             },
         },
         'postComments.show': {
             uri: 'posts/{post}/comments/{comment}',
             methods: ['GET', 'HEAD'],
             bindings: {
                 post: 'id',
                 comment: 'uuid',
             },
         },
         'translatePosts.index': {
             uri: '{locale}/posts',
             methods: ['GET', 'HEAD'],
         },
         'translatePosts.show': {
             uri: '{locale}/posts/{id}',
             methods: ['GET', 'HEAD'],
         },
         'translatePosts.update': {
             uri: '{locale}/posts/{post}',
             methods: ['PUT', 'PATCH'],
         },
         'events.venues-index': {
             uri: 'events/{event}/venues-index',
             methods: ['GET', 'HEAD'],
             bindings: {
                 event: 'id',
             },
         },
         'events.venues.index': {
             uri: 'events/{event}/venues',
             methods: ['GET', 'HEAD'],
             bindings: {
                 event: 'id',
             },
         },
         'events.venues.show': {
             uri: 'events/{event}/venues/{venue}',
             methods: ['GET', 'HEAD'],
             bindings: {
                 event: 'id',
                 venue: 'id',
             },
         },
         'events.venues.update': {
             uri: 'events/{event}/venues/{venue}',
             methods: ['PUT', 'PATCH'],
         },
         'translateEvents.venues.show': {
             uri: '{locale}/events/{event}/venues/{venue}',
             methods: ['GET', 'HEAD'],
             bindings: {
                 event: 'id',
                 venue: 'id',
             },
         },
         'conversations.show': {
             uri: 'subscribers/{subscriber}/conversations/{type}/{conversation_id?}',
             methods: ['GET', 'HEAD'],
         },
         optional: {
             uri: 'optional/{id}/{slug?}',
             methods: ['GET', 'HEAD'],
         },
         optionalId: {
             uri: 'optionalId/{type}/{id?}',
             methods: ['GET', 'HEAD'],
         },
         'team.user.show': {
             uri: 'users/{id}',
             methods: ['GET', 'HEAD'],
             domain: '{team}.navigare.test:443/navigare',
         },
         'translateTeam.user.show': {
             uri: '{locale}/users/{id}',
             methods: ['GET', 'HEAD'],
             domain: '{team}.navigare.test:443/navigare',
         },
         'products.show': {
             uri: '{country?}/{language?}/products/{id}',
             methods: ['GET', 'HEAD'],
         },
         'hosting-contacts.index': {
             uri: 'hosting-contacts',
             methods: ['GET', 'HEAD'],
         },
         'pages.optional': {
             uri: 'optionalpage/{page?}',
             methods: ['GET', 'HEAD'],
         },
         'pages.optionalExtension': {
             uri: 'download/file{extension?}',
             methods: ['GET', 'HEAD'],
         },
         'pages.requiredExtension': {
             uri: 'strict-download/file{extension}',
             methods: ['GET', 'HEAD'],
         },
         'pages.optionalWhere': {
             uri: 'where/optionalpage/{page?}',
             methods: ['GET', 'HEAD'],
             wheres: {
                 page: '[0-9]+',
             },
         },
         'pages.optionalExtensionWhere': {
             uri: 'where/download/file{extension?}',
             methods: ['GET', 'HEAD'],
             wheres: {
                 extension: '\\.(php|html)',
             },
         },
         'pages.requiredExtensionWhere': {
             uri: 'where/strict-download/file{extension}',
             methods: ['GET', 'HEAD'],
             wheres: {
                 extension: '\\.(php|html)',
             },
         },
         'pages.complexWhere': {
             uri: 'where/{word}-{digit}/{required}/{optional?}/file{extension?}',
             methods: ['GET', 'HEAD'],
             wheres: {
                 word: '[a-z_-]+',
                 digit: '[0-9]+',
                 required: 'required',
                 optional: 'optional',
                 extension: '\\.(php|html)',
             },
         },
         'pages.complexWhereConflict1': {
             uri: 'where/{digit}-{word}/{required}/{optional?}/file{extension?}',
             methods: ['GET', 'HEAD'],
             wheres: {
                 word: '[a-z_-]+',
                 digit: '[0-9]+',
                 required: 'required',
                 optional: 'optional',
                 extension: '\\.(php|html)',
             },
         },
         'pages.complexWhereConflict2': {
             uri: 'where/complex-{digit}/{required}/{optional?}/file{extension?}',
             methods: ['GET', 'HEAD'],
             wheres: {
                 digit: '[0-9]+',
                 required: 'different_but_required',
                 optional: 'optional',
                 extension: '\\.(php|html)',
             },
         },
         pages: {
             uri: '{page}',
             methods: ['GET', 'HEAD'],
         },
         slashes: {
             uri: 'slashes/{encoded}/{slug}',
             methods: ['GET', 'HEAD'],
             wheres: {
                 slug: '.*',
             },
         },
     },
 };
 
 beforeEach(() => {
     window.location = { ...defaultWindow.location };
 });
 
 describe.only('route()', () => {
     it('can generate a URL with no parameters', () => {
         expect(route(routes['posts.index'] as never), '/posts');
     });
 
     it('can generate a URL with default parameters', () => {
         expect(route(routes['translatePosts.index']), '/en/posts');
     });
 
     it('can generate a relative URL by passing absolute = false', () => {
         expect(route(routes['posts.index'] as never, [], false), '/posts');
     });
 
     it('can generate a URL with filled optional parameters', () => {
         expect(
             route(routes['conversations.show'] as never, {
                 type: 'email',
                 subscriber: 123,
                 conversation_id: 1234,
             }),
             '/subscribers/123/conversations/email/1234'
         );
     });
 
     it('can generate a relative URL with filled optional parameters', () => {
         expect(
             route(routes['conversations.show'] as never, {
                 type: 'email',
                 subscriber: 123,
                 conversation_id: 1234,
             }, false),
             '/subscribers/123/conversations/email/1234'
         );
     });
 
     it('can generate a relative URL with default parameters', () => {
         expect(route(routes['translatePosts.index'] as never, [], false), '/en/posts');
     });
 
     it('can error if a required parameter is not provided', () => {
         throws(() => route(routes['posts.show']), /'post' parameter is required/);
     });
 
     it('can error if a required parameter is not provided to a route with default parameters', () => {
         throws(() => route(routes['translatePosts.show']), /'id' parameter is required/);
     });
 
     it('can error if a required parameter with a default has no default value', () => {
         global.Ziggy.defaults = {};
 
         throws(
             () => route(routes['translatePosts.index']),
             /'locale' parameter is required/
         );
     });
 
     it('can generate a URL using an integer', () => {
         // route with required parameters
         expect(route(routes['posts.show'] as never, 1), '/posts/1');
         // route with default parameters
         expect(route(routes['translatePosts.show'] as never, 1), '/en/posts/1');
     });
 
     it('can generate a URL using a string', () => {
         // route with required parameters
         expect(route(routes['posts.show'] as never, 'my-first-post'), '/posts/my-first-post');
         // route with default parameters
         expect(route(routes['translatePosts.show'] as never, 'my-first-post'), '/en/posts/my-first-post');
     });
 
     it('can generate a URL using an object', () => {
         // routes with required parameters
         expect(route(routes['posts.show'] as never, { id: 1 }), '/posts/1');
         expect(route(routes['events.venues.show'] as never, { event: 1, venue: 2 }), '/events/1/venues/2');
         // route with optional parameters
         expect(route(routes['optionalId'] as never, { type: 'model', id: 1 }), '/optionalId/model/1');
         // route with both required and default parameters
         expect(route(routes['translateEvents.venues.show'] as never, { event: 1, venue: 2 }), '/en/events/1/venues/2');
     });
 
     it('can generate a URL using an array', () => {
         // routes with required parameters
         expect(route(routes['posts.show'] as never, [1]), '/posts/1');
         expect(route(routes['events.venues.show'] as never, [1, 2]), '/events/1/venues/2');
         expect(route(routes['events.venues.show'] as never, [1, 'coliseum']), '/events/1/venues/coliseum');
         // route with default parameters
         expect(route(routes['translatePosts.show'] as never, [1]), '/en/posts/1');
         // route with both required and default parameters
         expect(route(routes['translateEvents.venues.show'] as never, [1, 2]), '/en/events/1/venues/2');
     });
 
     it('can generate a URL using an array of objects', () => {
         const event = { id: 1, name: 'World Series' };
         const venue = { id: 2, name: 'Rogers Centre' };
 
         // route with required parameters
         expect(route(routes['events.venues.show'] as never, [event, venue]), '/events/1/venues/2');
         // route with required and default parameters
         expect(route(routes['translateEvents.venues.show'] as never, [event, venue]), '/en/events/1/venues/2');
     });
 
     it('can generate a URL using an array of integers and objects', () => {
         const venue = { id: 2, name: 'Rogers Centre' };
 
         // route with required parameters
         expect(route(routes['events.venues.show'] as never, [1, venue]), '/events/1/venues/2');
         // route with required and default parameters
         expect(route(routes['translateEvents.venues.show'] as never, [1, venue]), '/en/events/1/venues/2');
     });
 
     it('can generate a URL for a route with domain parameters', () => {
         // route with required domain parameters
         expect(route(routes['team.user.show'] as never, { team: 'tighten', id: 1 }), 'https://tighten.navigare.test:443/navigare/users/1');
         // route with required domain parameters and default parameters
         expect(route(routes['translateTeam.user.show'] as never, { team: 'tighten', id: 1 }), 'https://tighten.navigare.test:443/navigare/en/users/1');
     });
 
     it('can generate a URL for a route with a custom route model binding scope', () => {
         expect(
             route(routes['postComments.show'] as never, [
                 { id: 1, title: 'Post' },
                 { uuid: 12345, title: 'Comment' },
             ]),
             '/posts/1/comments/12345'
         );
         expect(
             route(routes['postComments.show'] as never, [1, { uuid: 'correct-horse-etc-etc' }]),
             '/posts/1/comments/correct-horse-etc-etc'
         );
     });
 
     it("can fall back to an 'id' key if an object is passed for a parameter with no registered bindings", () => {
         expect(route(routes['translatePosts.update'] as never, { id: 14 }), '/en/posts/14');
         expect(route(routes['translatePosts.update'] as never, [{ id: 14 }]), '/en/posts/14');
         expect(route(routes['events.venues.update'] as never, [{ id: 10 }, { id: 1 }]), '/events/10/venues/1');
     });
 
     it('can generate a URL for an app installed in a subfolder', () => {
         global.Ziggy.url = '/subfolder';
 
         expect(
             route(routes['postComments.show'] as never, [1, { uuid: 'correct-horse-etc-etc' }]),
             '/subfolder/posts/1/comments/correct-horse-etc-etc'
         );
     });
 
     it('can error if a route model binding key is missing', () => {
         throws(
             () => route(routes['postComments.show'] as never, [1, { count: 20 }]),
             /Ziggy error: object passed as 'comment' parameter is missing route model binding key 'uuid'\./
         );
     });
 
     it('can return base URL if path is "/"', () => {
         expect(route(routes['home']), 'https://navigare.test:443/navigare');
     });
 
     // @todo duplicate
     it('can ignore an optional parameter', () => {
         expect(route(routes['optional'] as never, { id: 123 }), '/optional/123');
         expect(route(routes['optional'] as never, { id: 123, slug: 'news' }), '/optional/123/news');
         expect(route(routes['optional'] as never, { id: 123, slug: null }), '/optional/123');
     });
 
     it('can ignore a single optional parameter', () => {
         expect(route(routes['pages.optional']), '/optionalpage');
         expect(route(routes['pages.optional'] as never, {}), '/optionalpage');
         expect(route(routes['pages.optional'] as never, undefined), '/optionalpage');
         expect(route(routes['pages.optional'] as never, null), '/optionalpage');
     });
 
     it('can error if a route name doesn’t exist', () => {
         throws(() => route('unknown-route'), /Ziggy error: route 'unknown-route' is not in the route list\./);
     });
 
     it('can automatically append extra parameter values as a query string', () => {
         expect(
             route(routes['events.venues.show'] as never, {
                 event: 1,
                 venue: 2,
                 search: 'rogers',
                 page: 2,
             }),
             '/events/1/venues/2?search=rogers&page=2'
         );
         expect(
             route(routes['events.venues.show'] as never, {
                 id: 2,
                 event: 1,
                 venue: 2,
                 search: 'rogers',
             }),
             '/events/1/venues/2?id=2&search=rogers'
         );
         // ignore values explicitly set to `null`
         expect(route(routes['posts.index'] as never, { filled: 'filling', empty: null }), '/posts?filled=filling');
     });
 
     it('can cast boolean query parameters to integers', () => {
         expect(route(routes['posts.show'] as never, { post: 1, preview: true }), '/posts/1?preview=1');
     });
 
     it('can explicitly append query parameters using _query parameter', () => {
         expect(
             route(routes['events.venues.show'] as never, {
                 event: 1,
                 venue: 2,
                 _query: {
                     event: 4,
                     venue: 2,
                 },
             }),
             '/events/1/venues/2?event=4&venue=2'
         );
         expect(
             route(routes['events.venues.show'] as never, {
                 event: { id: 4, name: 'Fun Event' },
                 _query: {
                     event: 9,
                     id: 12,
                 },
                 venue: 2,
             }),
             '/events/4/venues/2?event=9&id=12'
         );
     });
 
     it('can generate a URL with a port', () => {
         global.Ziggy.url = 'https://navigare.test:443/navigare:81';
         global.Ziggy.port = 81;
 
         // route with no parameters
         expect(route(routes['posts.index']), 'https://navigare.test:443/navigare:81/posts');
         // route with required domain parameters
         expect(route(routes['team.user.show'] as never, { team: 'tighten', id: 1 }), 'https://tighten.navigare.test:443/navigare:81/users/1');
     });
 
     it('can handle trailing path segments in the base URL', () => {
         global.Ziggy.url = 'https://test.thing/ab/cd';
 
         expect(route(routes['events.venues.index'] as never, 1), 'https://test.thing/ab/cd/events/1/venues');
     });
 
     it('can URL-encode named parameters', () => {
         global.Ziggy.url = 'https://test.thing/ab/cd';
 
         expect(
             route(routes['events.venues.index'] as never, { event: 'Fun&Games' }),
             'https://test.thing/ab/cd/events/Fun%26Games/venues'
         );
         expect(
             route(routes['events.venues.index'] as never, {
                 event: 'Fun&Games',
                 location: 'Blues&Clues',
             }),
             'https://test.thing/ab/cd/events/Fun%26Games/venues?location=Blues%26Clues'
         );
     });
 
     it('can format an array of query parameters', () => {
         expect(
             route(routes['events.venues.index'] as never, {
                 event: 'test',
                 guests: ['a', 'b', 'c'],
             }),
             '/events/test/venues?guests[0]=a&guests[1]=b&guests[2]=c'
         );
     });
 
     it('can handle a parameter explicity set to `0`', () => {
         expect(route(routes['posts.update'] as never, 0), '/posts/0');
     });
 
     it('can accept a custom Ziggy configuration object', () => {
         const config = {
             url: 'http://notYourAverage.dev',
             port: null,
             defaults: { locale: 'en' },
             routes: {
                 'tightenDev.packages.index': {
                     uri: 'tightenDev/{dev}/packages',
                     methods: ['GET', 'HEAD'],
                 },
             },
         };
 
         expect(
             route(routes['tightenDev.packages.index'] as never, { dev: 1 }, true, config),
             'http://notYourAverage.dev/tightenDev/1/packages'
         );
     });
 
     it('can extract parameters for an app installed in a subfolder', () => {
         global.Ziggy.url = '/subfolder';
 
         global.window.location.href = '/subfolder/ph/en/products/4';
         global.window.location.host = 'navigare.test:443/navigare';
         global.window.location.pathname = '/subfolder/ph/en/products/4';
 
         deepEqual(route().params, { country: 'ph', language: 'en', id: '4' });
     });
 
     it('can extract parameters for an app installed in nested subfolders', () => {
         global.Ziggy.url = '/nested/subfolder';
 
         global.window.location.href = '/nested/subfolder/ph/en/products/4';
         global.window.location.host = 'navigare.test:443/navigare';
         global.window.location.pathname = '/nested/subfolder/ph/en/products/4';
 
         deepEqual(route().params, { country: 'ph', language: 'en', id: '4' });
     });
 
     it('can extract domain parameters from the current URL', () => {
         global.window.location.href = 'https://tighten.navigare.test:443/navigare/users/1';
         global.window.location.host = 'tighten.navigare.test:443/navigare';
         global.window.location.pathname = '/users/1';
 
         deepEqual(route().params, { team: 'tighten', id: '1' });
     });
 
     it('can extract named parameters from the current URL', () => {
         global.window.location.href = '/posts/1';
         global.window.location.host = 'navigare.test:443/navigare';
         global.window.location.pathname = '/posts/1';
 
         deepEqual(route().params, { post: '1' });
 
         global.window.location.href = '/events/1/venues/2';
         global.window.location.pathname = '/events/1/venues/2';
 
         deepEqual(route().params, { event: '1', venue: '2' });
     });
 
     it('can extract query parameters from the current URL', () => {
         global.window.location.href = '/posts/1?guest[name]=Taylor';
         global.window.location.host = 'navigare.test:443/navigare';
         global.window.location.pathname = '/posts/1';
         global.window.location.search = '?guest[name]=Taylor';
 
         deepEqual(route().params, { post: '1', guest: { name: 'Taylor' } });
 
         global.window.location.href = '/events/1/venues/2?id=5&vip=0';
         global.window.location.pathname = '/events/1/venues/2';
         global.window.location.search = '?id=5&vip=0';
 
         deepEqual(route().params, { event: '1', venue: '2', id: '5', vip: '0' });
     });
 
     it("can append 'extra' string/number parameter to query", () => {
         // 'posts.index' has no parameters
         expect(route(routes['posts.index'] as never, 'extra'), '/posts?extra=');
         expect(route(routes['posts.index'] as never, [{extra: 2}]), '/posts?extra=2');
         expect(route(routes['posts.index'] as never, 1), '/posts?1=');
     });
 
     it("can append 'extra' string/number elements in array of parameters to query", () => {
         // 'posts.show' has exactly one parameter
          expect(route(routes['posts.show'] as never, [1, 2]), '/posts/1?2=');
          expect(route(routes['posts.show'] as never, ['my-first-post', 'foo', 'bar']), '/posts/my-first-post?foo=&bar=');
     });
 
     it("can automatically append object with only 'extra' parameters to query", () => {
         // Route has no parameters, the entire parameters object is 'extra' and should be used as the query string
         expect(route('hosting-contacts.index', { filter: { name: 'Dwyer' } }), '/hosting-contacts?filter[name]=Dwyer');
     });
 
     it("can append 'extra' object parameter to query", () => {
         expect(route(routes['posts.show'] as never, { post: 2, filter: { name: 'Dwyer' } }), '/posts/2?filter[name]=Dwyer');
     });
 
     it('can generate a URL for a route with parameters inside individual segments', () => {
         expect(route(routes['pages.requiredExtension'] as never, 'x'), '/strict-download/filex');
         expect(route(routes['pages.requiredExtension'] as never, '.html'), '/strict-download/file.html');
         expect(route(routes['pages.requiredExtension'] as never, { extension: '.pdf' }), '/strict-download/file.pdf');
     });
 
     it('can generate a URL for a route with optional parameters inside individual segments', () => {
         expect(route(routes['pages.optionalExtension']), '/download/file');
         expect(route(routes['pages.optionalExtension'] as never, '.html'), '/download/file.html');
         expect(route(routes['pages.optionalExtension'] as never, { extension: '.pdf' }), '/download/file.pdf');
     });
 
     it('can generate a URL for a route with optional parameters inside individual segments respecting where requirements', () => {
         expect(route(routes['pages.optionalExtensionWhere']), '/where/download/file');
         expect(route(routes['pages.optionalExtensionWhere'] as never, '.html'), '/where/download/file.html');
         throws(() => route(routes['pages.optionalExtensionWhere'] as never, { extension: '.pdf' }), /'extension' parameter does not match required format/);
     });
 
     it('can generate a URL for a route with parameters inside individual segments', () => {
         expect(route(routes['pages.requiredExtensionWhere'] as never, '.html'), '/where/strict-download/file.html');
         throws(() => route(routes['pages.requiredExtensionWhere'] as never, 'x'), /'extension' parameter does not match required format/);
         throws(() => route(routes['pages.requiredExtensionWhere'] as never, { extension: '.pdf' }), /'extension' parameter does not match required format/);
     });
 
 
     it('can skip encoding slashes inside last parameter when explicitly allowed', () => {
         expect(route(routes['slashes'] as never, ['one/two', 'three/four']), '/slashes/one%2Ftwo/three/four');
         expect(route(routes['slashes'] as never, ['one/two', 'Fun&Games/venues']), '/slashes/one%2Ftwo/Fun%26Games/venues');
         expect(route(routes['slashes'] as never, ['one/two/three', 'Fun&Games/venues/outdoors']), '/slashes/one%2Ftwo%2Fthree/Fun%26Games/venues/outdoors');
     });
 });
 
 describe('has()', () => {
     it('can check if given named route exists', () => {
         assert(route().has('posts.show'));
         assert(!route().has('non.existing.route'));
     });
 
     it('can check if given named route exists with .check()', () => {
         assert(route().check('posts.show'));
         assert(!route().check('non.existing.route'));
     });
 });
 
 describe('current()', () => {
     it('can get the current route name', () => {
         global.window.location.pathname = '/events/1/venues/2';
 
         expect(route().current(), 'events.venues.show');
     });
 
     it('can get the current route name on a route with multiple allowed HTTP methods', () => {
         global.window.location.pathname = '/posts/1';
 
         expect(route().current(), 'posts.show');
     });
 
     it('can get the current route name with a missing protocol', () => {
         global.window.location.pathname = '/events/1/venues/';
         global.window.location.protocol = '';
 
         expect(route().current(), 'events.venues.index');
     });
 
     it('can get the current route name at the domain root', () => {
         global.window.location.href = 'https://navigare.test:443/navigare';
         global.window.location.host = 'navigare.test:443/navigare';
         global.window.location.pathname = '/';
 
         expect(route().current(), 'home');
         expect(route().current('home'), true);
     });
 
     it('can ignore query string when getting current route name', () => {
         global.window.location.pathname = '/events/1/venues?foo=2';
 
         expect(route().current(), 'events.venues.index');
     });
 
     it('can ignore domain when getting current route name and absolute is false', () => {
         global.window.location.href = 'https://tighten.navigare.test:443/navigare/events/1/venues?foo=2';
         global.window.location.host = 'tighten.navigare.test:443/navigare';
         global.window.location.pathname = '/events/1/venues?foo=2';
 
         expect(route(undefined, undefined, false).current(), 'events.venues.index');
 
         global.window.location.href = 'https://example.com/events/1/venues?foo=2';
         global.window.location.host = 'example.com';
         global.window.location.pathname = '/events/1/venues?foo=2';
 
         expect(route(undefined, undefined, false).current(), 'events.venues.index');
     });
 
     it('can ignore domain when getting current route name, absolute is false, and app is in a subfolder', () => {
         global.Ziggy.url = 'https://tighten.navigare.test:443/navigare/subfolder';
         global.window.location.href = 'https://tighten.navigare.test:443/navigare/subfolder/events/1/venues?foo=2';
         global.window.location.pathname = '/subfolder/events/1/venues?foo=2';
 
         expect(route(undefined, undefined, false).current(), 'events.venues.index');
 
         global.Ziggy.url = 'https://example.com/nested/subfolder';
         global.window.location.href = 'https://example.com/nested/subfolder/events/1/venues?foo=2';
         global.window.location.pathname = '/nested/subfolder/events/1/venues?foo=2';
 
         expect(route(undefined, undefined, false).current(), 'events.venues.index');
     });
 
     it('can get the current route name with a custom Ziggy object', () => {
         global.Ziggy = undefined;
         global.window.location.pathname = '/events/';
 
         const config = {
             url: 'https://navigare.test:443/navigare',
             port: null,
             routes: {
                 'events.index': {
                     uri: 'events',
                     methods: ['GET', 'HEAD'],
                 },
             },
         };
 
         expect(route(undefined, undefined, undefined, config).current(), 'events.index');
     });
 
     it('can return undefined when getting the current route name on an unknown URL', () => {
         global.window.location.pathname = '/unknown/path';
 
         expect(route().current(), undefined);
     });
 
     it('can check the current route name on a route/URL made up entirely of a single parameter', () => {
         global.window.location.pathname = '/some-page';
 
         expect(route().current(), 'pages');
         expect(route().current('pages', { page: 'some-page' }), true);
     });
 
     it('can check the current route name on a route/URL made up entirely of a single optional parameter', () => {
         global.window.location.pathname = '/optionalpage/foo';
 
         expect(route().current(), 'pages.optional');
         expect(route().current('pages.optional', ''), false);
         expect(route().current('pages.optional', ['']), false);
         // expect(route().current('pages.optional', []), false); // Not supported
         expect(route().current('pages.optional', { page: '' }), false);
         expect(route().current('pages.optional', { page: undefined }), false);
         expect(route().current('pages.optional', { page: 'foo' }), true);
     });
 
     it('can check the current route name on a route/URL made up entirely of a single optional parameter and with that parameter missing', () => {
         global.window.location.pathname = '/optionalpage';
 
         expect(route().current(), 'pages.optional');
         expect(route().current('pages.optional', ''), true);
         // expect(route().current('pages.optional', []), true); // Not supported
         expect(route().current('pages.optional', ['']), true);
         expect(route().current('pages.optional', { page: '' }), true);
         expect(route().current('pages.optional', { page: undefined }), true);
         expect(route().current('pages.optional', { page: 'foo' }), false);
 
         global.window.location.pathname = '/where/optionalpage';
         expect(route().current('pages.optionalWhere', { page: undefined }), true);
         expect(route().current('pages.optionalWhere', { page: 'foo' }), false);
         global.window.location.pathname = '/where/optionalpage/23';
         expect(route().current('pages.optionalWhere', { page: 23 }), true);
         expect(route().current('pages.optionalWhere', { page: 22 }), false);
     });
 
     it('can check current route with complex requirements without conflicts', () => {
         global.window.location.pathname = '/where/word-12/required/file';
         expect(route().current('pages.complexWhere'), true);
         expect(route().current('pages.complexWhereConflict1'), false);
 
         global.window.location.pathname = '/where/complex-12/required/file';
         expect(route().current('pages.complexWhere', {word: 'complex', digit: '12', required: 'required'}), true);
         expect(route().current('pages.complexWhereConflict1'), false);
 
         global.window.location.pathname = '/where/123-abc/required/file.html';
         expect(route().current('pages.complexWhereConflict1'), true);
         expect(route().current('pages.complexWhere'), false);
 
         global.window.location.pathname = '/where/complex-12/different_but_required/optional/file';
         expect(route().current('pages.complexWhereConflict2'), true);
         expect(route().current('pages.complexWhere'), false);
     });
 
     it('can current route with complex requirements is dehydrated correctly', () => {
         global.window.location.pathname = '/where/word-12/required/file';
         deepEqual(route().params, {digit: '12', word: 'word', required: 'required', optional: undefined, extension: undefined})
 
         global.window.location.pathname = '/where/complex-12/required/optional/file';
         deepEqual(route().params, {digit: '12', word: 'complex', required: 'required', optional: 'optional', extension: undefined})
 
         global.window.location.pathname = '/where/123-abc/required/file.html';
         deepEqual(route().params, {digit: '123', word: 'abc', required: 'required', optional: undefined, extension: '.html'})
 
         global.window.location.pathname = '/where/complex-12/different_but_required/optional/file';
         deepEqual(route().params, {digit: '12', required: 'different_but_required', optional: 'optional', extension: undefined})
 
         global.window.location.search = '?ab=cd&ef=1&dd';
         deepEqual(route().params, {digit: '12', required: 'different_but_required', optional: 'optional', extension: undefined, ab: 'cd', ef: '1', 'dd': ''})
     });
 
     it('can strip regex start and end of string tokens from wheres', () => {
         global.Ziggy = undefined;
         global.window.location.pathname = '/workspace/processes';
 
         const config = {
             url: 'https://navigare.test:443/navigare',
             port: null,
             routes: {
                 'workspaces.processes.index': {
                     uri: '{workspace}/processes',
                     methods: ['GET', 'HEAD'],
                     wheres: {
                         workspace: '^(?!api|nova-api|horizon).*$',
                     },
                 },
             },
         };
 
         expect(route(undefined, undefined, undefined, config).current(), 'workspaces.processes.index');
     });
 
     it('can check the current route name at a URL with a non-delimited parameter', () => {
         global.window.location.pathname = '/strict-download/file.html';
 
         expect(route().current(), 'pages.requiredExtension');
         expect(route().current('pages.requiredExtension', ''), false);
         expect(route().current('pages.requiredExtension*', ''), false);
         expect(route().current('pages.requiredExtension', '.html'), true);
         expect(route().current('pages.requiredExtension*', '.html'), true);
         expect(route().current('pages.requiredExtension', ['']), false);
         expect(route().current('pages.requiredExtension*', ['']), false);
         expect(route().current('pages.requiredExtension', ['.html']), true);
         expect(route().current('pages.requiredExtension*', ['.html']), true);
         expect(route().current('pages.requiredExtension', { extension: '' }), false);
         expect(route().current('pages.requiredExtension*', { extension: '' }), false);
         expect(route().current('pages.requiredExtension', { extension: '.pdf' }), false);
         expect(route().current('pages.requiredExtension*', { extension: '.pdf' }), false);
         expect(route().current('pages.requiredExtension', { extension: '.html' }), true);
         expect(route().current('pages.requiredExtension*', { extension: '.html' }), true);
     });
 
     it('can check the current route name at a URL with a missing non-delimited optional parameter', () => {
         global.window.location.pathname = '/download/file';
 
         expect(route().current(), 'pages.optionalExtension');
         expect(route().current('pages.optionalExtension', ''), true);
         expect(route().current('pages.optionalExtension*', ''), true);
         expect(route().current('pages.optionalExtension', ['']), true);
         expect(route().current('pages.optionalExtension*', ['']), true);
         expect(route().current('pages.optionalExtension', { extension: '' }), true);
         expect(route().current('pages.optionalExtension*', { extension: '' }), true);
         expect(route().current('pages.optionalExtension', { extension: '.html' }), false);
         expect(route().current('pages.optionalExtension*', { extension: '.pdf' }), false);
     });
 
     it('can check the current route name at a URL with a non-delimited optional parameter', () => {
         global.window.location.pathname = '/download/file.html';
 
         expect(route().current(), 'pages.optionalExtension');
         expect(route().current('pages.optionalExtension', ''), false);
         expect(route().current('pages.optionalExtension*', ''), false);
         expect(route().current('pages.optionalExtension', '.html'), true);
         expect(route().current('pages.optionalExtension*', '.html'), true);
         expect(route().current('pages.optionalExtension', ['']), false);
         expect(route().current('pages.optionalExtension*', ['']), false);
         expect(route().current('pages.optionalExtension', ['.html']), true);
         expect(route().current('pages.optionalExtension*', ['.html']), true);
         expect(route().current('pages.optionalExtension', { extension: '' }), false);
         expect(route().current('pages.optionalExtension*', { extension: '' }), false);
         expect(route().current('pages.optionalExtension', { extension: '.pdf' }), false);
         expect(route().current('pages.optionalExtension*', { extension: '.pdf' }), false);
         expect(route().current('pages.optionalExtension', { extension: '.html' }), true);
         expect(route().current('pages.optionalExtension*', { extension: '.html' }), true);
 
         global.window.location.pathname = '/where/download/file.html';
         expect(route().current('pages.optionalExtensionWhere', { extension: '.html' }), true);
 
         global.window.location.pathname = '/where/download/file.pdf';
         expect(route().current('pages.optionalExtensionWhere', { extension: '.pdf' }), false);
     });
 
     it('can check the current route name with parameters on a URL with no parameters', () => {
         global.window.location.href = 'https://navigare.test:443/navigare';
         global.window.location.host = 'navigare.test:443/navigare';
         global.window.location.pathname = '/';
 
         expect(route().current('home', { page: 'test' }), false);
         expect(route().current('pages', { page: 'test' }), false);
 
         global.window.location.pathname = '/posts/';
 
         expect(route().current('posts.index', { post: 1 }), false);
         expect(route().current('posts.show', { post: 1 }), false);
     });
 
     it('can check the current route name with positional parameters on a URL with no parameters', () => {
         global.window.location.pathname = '/posts';
         global.window.location.search = '?0=test';
 
         expect(route().current('posts.index', undefined), true);
         expect(route().current('posts.index', null), true);
         expect(route().current('posts.index', {}), true);
         expect(route().current('posts.index', { '0': 'test' }), true);
 
         expect(route().current('posts.index', ''), false);
         expect(route().current('posts.index', 'test'), false);
         // expect(route().current('posts.index', []), false); // Not supported
         expect(route().current('posts.index', ['']), false);
         expect(route().current('posts.index', [1]), false);
     });
 
     it('can return false when checking the current route name on an unknown route', () => {
         global.window.location.pathname = '/unknown/';
 
         expect(route().current('posts.delete'), false);
     });
 
     it('can return false when checking the current route name and params on an unknown URL', () => {
         global.window.location.pathname = '/unknown/path';
 
         expect(route().current('posts.show', { post: 2 }), false);
         expect(route().current('posts.show', 2), false);
         expect(route().current('posts.show', [2]), false);
         expect(route().current('posts.show', 'post'), false);
     });
 
     it('can return false when checking a non-existent route name on a known URL', () => {
         global.window.location.pathname = '/events/1/venues/2';
 
         expect(route().current('random-route'), false);
     });
 
     it('can return false when checking a non-existent route name on an unknown URL', () => {
         global.window.location.pathname = '/unknown/test';
 
         expect(route().current('random-route'), false);
     });
 
     it('can return false when checking a non-existent route name and params on a known URL', () => {
         global.window.location.pathname = '/events/1/venues/2';
 
         expect(route().current('random-route', { post: 2 }), false);
         expect(route().current('random-route', 2), false);
         expect(route().current('random-route', [2]), false);
         expect(route().current('random-route', 'post'), false);
     });
 
     it('can return false when checking a non-existent route name and params on an unknown URL', () => {
         global.window.location.pathname = '/unknown/params';
 
         expect(route().current('random-route', { post: 2 }), false);
         expect(route().current('random-route', 2), false);
         expect(route().current('random-route', [2]), false);
         expect(route().current('random-route', 'post'), false);
     });
 
     it('can check the current route name against a pattern', () => {
         global.window.location.pathname = '/events/1/venues/2';
 
         assert(route().current('events.venues.show'));
         assert(route().current('events.venues.*'));
         assert(route().current('events.*.show'));
         assert(route().current('*.venues.show'));
         assert(route().current('events.*'));
 
         assert(!route().current('events.venues.index'));
         assert(!route().current('events.users.*'));
         assert(!route().current('*.users.show'));
         assert(!route().current('events'));
         assert(!route().current('show'));
 
         global.window.location.pathname = '/hosting-contacts';
 
         assert(route().current('hosting-contacts.index'));
         assert(route().current('*.index'));
         // https://github.com/tighten/ziggy/pull/296
         assert(!route().current('hosting.*'));
     });
 
     it('can check the current route name on a route with filled optional parameters', () => {
         global.window.location.pathname = '/optional/1/foo';
 
         assert(route().current('optional'));
     });
 
     it('can check the current route name on a route with trailing empty optional parameters', () => {
         global.window.location.pathname = '/optional/1';
 
         assert(route().current('optional'));
     });
 
     it('can check the current route name on a route with optional parameters in the middle of the URI', () => {
         global.Ziggy.url = '/subfolder';
 
         // Missing the optional 'language' parameter (e.g. subfolder/ph/en/products...)
         global.window.location.href = '/subfolder/ph/products/4';
         global.window.location.host = 'navigare.test:443/navigare';
         global.window.location.pathname = '/subfolder/ph/products/4';
 
         assert(route().current('products.show'));
     });
 
     it('can check the current route with parameters', () => {
         global.window.location.pathname = '/events/1/venues/2';
 
         expect(route().current('events.venues.show', { event: 1, venue: 2 }), true);
         expect(route().current('events.venues.show', [1, 2]), true);
         expect(route().current('events.venues.show', [1, { id: 2, name: 'Grand Canyon' }]), true);
         expect(route().current('events.venues.show', { event: 1 }), true);
         expect(route().current('events.venues.show', { venue: 2 }), true);
         expect(route().current('events.venues.show', [1]), true);
         expect(route().current('events.venues.show', {}), true);
         expect(route().current('events.venues.show', null), true);
 
         expect(route().current('events.venues.show', { event: 4, venue: 2 }), false);
         expect(route().current('events.venues.show', { event: null }), false);
         expect(route().current('events.venues.show', [1, 6]), false);
         expect(route().current('events.venues.show', [{ id: 1 }, { id: 4, name: 'Great Pyramids' }]), false);
         expect(route().current('events.venues.show', { event: 4 }), false);
         expect(route().current('events.venues.show', { venue: 4 }), false);
         expect(route().current('events.venues.show', [5]), false);
     });
 
     it('can check the current route with parameters with incorrect parameter names', () => {
         global.window.location.pathname = '/events/1/venues/2';
 
         expect(route().current('events.venues.show', { eventz: 2 }), false);
     });
 
     it('can check the current route with query parameters', () => {
         global.window.location.pathname = '/events/1/venues/2';
         global.window.location.search = '?user=Jacob&id=9';
 
         assert(route().current('events.venues.show', { event: 1, venue: 2, user: 'Jacob' }));
         assert(route().current('events.venues.show', {
             event: { id: 1, name: 'Party' },
             venue: 2,
             id: 9,
         }));
         assert(route().current('events.venues.show', { user: 'Jacob', venue: { id: 2 } }));
 
         assert(!route().current('events.venues.show', { user: 'Matt', venue: { id: 9 } }));
         assert(!route().current('events.venues.show', { event: 5, id: 9, user: 'Jacob' }));
         assert(!route().current('events.venues.show', { id: 12, user: 'Matt' }));
     });
 
     it('can ignore routes that don’t allow GET requests', () => {
         global.window.location.pathname = '/posts/1';
 
         assert(!route().current('posts.update'));
     });
 
     it('can ignore trailing slashes', () => {
         global.window.location.pathname = '/events/1/venues/';
 
         expect(route().current(), 'events.venues.index');
     });
 
     it('matches route name with multiple periods', () => {
         global.window.location.pathname = '/events/1/venues';
 
         expect(route().current('events.venues-index'), false);
         expect(route().current('events.venues.index'), true);
 
         global.window.location.pathname = '/events/1/venues-index';
 
         expect(route().current('events.venues-index'), true);
         expect(route().current('events.venues.index'), false);
     });
 
     it('matches route name with multiple periods and wildcards', () => {
         global.window.location.pathname = '/events/1/venues-index';
 
         expect(route().current('events.venues-index'), true);
         expect(route().current('events.venues.*'), false);
     });
 
     it.skip('can unresolve arbitrary urls to names and params', () => {
         const resolved = route().unresolve('/events/1/venues?test=yes');
         deepEqual(resolved, { name: 'events.venues.index', params: {event: '1'}, query: {test: 'yes'}, route: resolved.route });
         expect(resolved.route.uri, 'events/{event}/venues');
 
         expect(route().unresolve('navigare.test:443/navigare/events/1/venues-index').name, 'events.venues-index');
         expect(route().unresolve('/events/1/venues-index').name, 'events.venues-index');
     });
 
     it('can get the current route name without window', () => {
         global.Ziggy = undefined;
         global.window = undefined;
 
         const config = {
             url: 'https://navigare.test:443/navigare',
             port: null,
             routes: {
                 'events.venues.show': {
                     uri: 'events/{event}/venues/{venue}',
                     methods: ['GET', 'HEAD'],
                     bindings: {
                         event: 'id',
                         venue: 'id',
                     },
                 },
             },
             location: {
                 host: 'navigare.test:443/navigare',
                 pathname: '/events/1/venues/2',
                 search: '?user=Jacob&id=9',
             },
         };
 
         expect(route(undefined, undefined, undefined, config).current(), 'events.venues.show');
     });
 });
 